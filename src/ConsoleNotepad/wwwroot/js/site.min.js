!function(){"use strict"}();var app=angular.module("ConsoleNotepad",["ngRoute"]);app.directive("contenteditable",[function(){return{require:"?ngModel",scope:{},link:function(t,e,n,o){e.bind("blur keyup change",function(){t.$apply(function(){o.$setViewValue(e.html())})}),o.$render=function(){e.html(o.$viewValue)},o.$render(),t.$on("$destroy",function(){e.unbind("blur"),e.unbind("paste"),e.unbind("focus")})}}}]),app.directive("focusOn",function(){return function(t,e,n){t.$on("focusOn",function(t,o){o===n.focusOn&&e[0].focus()})}}),app.factory("focusOn",function(t,e){return function(n){e(function(){t.$broadcast("focusOn",n)})}}),app.controller("editorController",function(t,e,n,o){function a(e){t.parts[e].localState="Sending",n.put(t.parts[e]).success(function(){t.parts[e].localState="OK"}).error(function(){t.parts[e].localState="Problem"})}function s(e){var a=e+1;null==e&&(a=0),t.parts.splice(a,0,{Data:"new",NoteID:t.currentNoteId}),o("part"+a),t.parts[a].localState="Sending",n.post(t.parts[a]).success(function(e){t.parts[a].ID=e.ID,t.parts[a].localState="OK"}).error(function(){t.parts[a].localState="Problem"})}function r(){(0==t.parts.length||null==t.parts)&&s()}t.suggestions={},t.highlightedSuggestion=-1,t.currentNoteId=0,t.parts=[{Data:"new"}];var u;t.focusOnPart=0,t.smartBarKeyDown=function(o){if(32==o.keyCode&&(t.suggestions=e.getSuggested(t.smartBar).success(function(e){console.table(e),t.suggestions=e}),console.log("Suggestions refreshed")),40==o.keyCode&&t.highlightedSuggestion<t.suggestions.length-1)o.preventDefault(),t.highlightedSuggestion++;else if(38==o.keyCode&&t.highlightedSuggestion>-1)o.preventDefault(),t.highlightedSuggestion--;else if(13==o.keyCode)if(-1!=t.highlightedSuggestion){t.smartBar="";var a=t.suggestions[t.highlightedSuggestion];console.table(a);for(var s in a.NoteTags)t.smartBar+=a.NoteTags[s].Tag.Name+" ";t.currentNoteId=a.NoteId,t.parts=n.get(t.currentNoteId).success(function(e){t.parts=e,console.log("Got data: "),console.table(e),r()})}else var a=e.getByTag(t.smartBar).success(function(e){console.table(e),t.currentNoteId=e.NoteId,t.parts=n.get(t.currentNoteId).success(function(e){t.parts=e,console.log("Got data: "),console.table(e),r()})});13!=o.keyCode&&40!=o.keyCode&&38!=o.keyCode&&(t.highlightedSuggestion=-1)},t.editingPartKeyDown=function(e,n){clearTimeout(u),u=setTimeout(function(){a(n)},1e3),t.parts[n].localState="Sending";var o=t.parts[n];13==e.keyCode&&/\s*<br>\s*<br>\s*$/.test(o.Data)&&(t.parts[n].Data=t.parts[n].Data.replace(/\s*<br>\s*$/g,""),s(n),e.preventDefault())}}),app.factory("notes",["$http",function(t){var e={};return e.get=function(){},e.getSuggested=function(e){return t({method:"GET",url:"/api/notes/suggested?searchText="+e,headers:{Accept:"application/json"}})},e.getByTag=function(e){return t({method:"GET",url:"/api/notes/bytags?searchText="+e,headers:{Accept:"application/json"}})},e.post=function(t){},e.put=function(t){console.table(t)},e}]),app.factory("parts",["$http",function(t){var e={};return e.get=function(e){return t({method:"GET",url:"/api/parts?idOfNote="+e,headers:{Accept:"application/json"}})},e.post=function(e){return t({method:"POST",url:"/api/Parts",data:e,headers:{Accept:"application/json"}})},e.put=function(e){return t({method:"PUT",url:"/api/Parts/"+e.ID,data:e,headers:{Accept:"application/json"}})},e}]);