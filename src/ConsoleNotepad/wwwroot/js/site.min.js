!function(){"use strict"}();var app=angular.module("ConsoleNotepad",["ngRoute"]);app.directive("ace",["$timeout",function(e){var t=function(e,t){var n=e.renderer.lineHeight,o=e.getSession().getLength;10>o&&(o=10),$(t).height(o*n),e.resize()};return{restrict:"A",require:"ngModel",scope:{ngModel:"=?"},link:function(n,o,a,i){var r=o[0],s=ace.edit(r);s.setTheme("ace/theme/monokai"),console.log("language: "+a.ace),s.getSession().setMode("ace/mode/"+a.ace),s.setShowPrintMargin(!1),n.$watch("ngModel",function(){s.getValue()!=n.ngModel&&s.setValue(n.ngModel,1)}),s.on("change",function(){e(function(){n.$apply(function(){var e=s.getValue();n.ngModel=e})}),t(s,o)})}}}]),app.directive("contenteditable",[function(){return{require:"?ngModel",scope:{},link:function(e,t,n,o){t.bind("blur keyup change",function(){e.$apply(function(){o.$setViewValue(t.html())})}),o.$render=function(){t.html(o.$viewValue)},o.$render(),e.$on("$destroy",function(){t.unbind("blur"),t.unbind("paste"),t.unbind("focus")})}}}]),app.directive("focusOn",function(e){return function(t,n,o){t.$on("focusOn",function(t,a){a===o.focusOn&&e(function(){if(n[0].focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var e=document.createRange();e.selectNodeContents(n[0]),e.collapse(!1);var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}else if("undefined"!=typeof document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(n[0]),o.collapse(!1),o.select()}})})}}),app.factory("focusOn",function(e,t){return function(n){t(function(){e.$broadcast("focusOn",n)})}}),app.controller("editorController",function(e,t,n,o,a){function i(t){e.parts[t].localState="Sending",n.put(e.parts[t]).success(function(){e.parts[t].localState="OK"}).error(function(){e.parts[t].localState="Problem"})}function r(){void 0==e.smartBar&&(e.smartBar=""),t.getByTag(e.smartBar).success(function(t){e.currentNoteId=t.NoteId,d(e.smartBar),e.parts=n.get(e.currentNoteId).success(function(e){u(e)})})}function s(t){e.smartBar="";var o=e.suggestions[t];console.table(o);for(var a in o.NoteTags)e.smartBar+=o.NoteTags[a].Tag.Name+" ";e.currentNoteId=o.NoteId,d(e.smartBar),e.parts=n.get(e.currentNoteId).success(function(e){u(e)})}function c(){(0==e.parts.length||null==e.parts)&&e.addPart()}function u(t){for(var n in t)t[n].Settings=void 0==t[n].SettingsAsJSON?new Array:JSON.parse(t[n].SettingsAsJSON);e.parts=t,console.log("Got data: "),console.table(t),c(),o("part"+(e.parts.length-1)+"window"+e.$index)}function d(t){var n=t.split(" "),o="";for(var a in n)if("!"==n[a].charAt(0)){o=n[a].substring(1);break}"code"==o||"c"==o?(e.noteType="javascript",e.onePartNote=!0):"view"==o||"v"==o?(e.noteType="html",e.onePartNote=!0):(e.noteType="text",e.onePartNote=!1)}e.windowId=0,e.suggestions={},e.showSuggestions=!1,e.highlightedSuggestion=-1,e.currentNoteId=0,e.parts=[{Data:"new"}];var g;e.activePart=0,e.onePartNote=!1,e.noteType="",r(),o("smartBar"),e.setWindowID=function(t){console.log("windowID: "+t),e.windowId=t},e.smartBarKeyDown=function(n){32==n.keyCode&&(e.suggestions=t.getSuggested(e.smartBar).success(function(t){console.table(t),e.suggestions=t}),console.log("Suggestions refreshed")),40==n.keyCode&&e.highlightedSuggestion<e.suggestions.length-1?(n.preventDefault(),e.highlightedSuggestion++):38==n.keyCode&&e.highlightedSuggestion>-1?(n.preventDefault(),e.highlightedSuggestion--):13==n.keyCode&&(-1!=e.highlightedSuggestion?s(e.highlightedSuggestion):r()),13!=n.keyCode&&40!=n.keyCode&&38!=n.keyCode&&(e.highlightedSuggestion=-1)},e.editingPartKeyDown=function(t,n){clearTimeout(g),g=setTimeout(function(){i(n)},1e3),e.parts[n].localState="Sending"},e.addPart=function(){var t=e.activePart+1;e.parts.splice(t,0,{Data:"&nbsp;",NoteID:e.currentNoteId}),o("part"+t+"window"+e.$index),e.parts[t].localState="Sending",e.parts[t].OrderPosition=e.parts[t-1].OrderPosition+1;for(var a in e.parts)a!=t&&e.parts[a].OrderPosition>=e.parts[t].OrderPosition&&e.parts[a].OrderPosition++;n.post(e.parts[t]).success(function(n){e.parts[t].ID=n.ID,e.parts[t].localState="OK"}).error(function(){e.parts[t].localState="Problem"})},e.suggestionClicked=function(e,t){1===t.which&&s(e)},e.focusedOnPart=function(t){e.activePart=t}}),app.factory("notes",["$http",function(e){var t={};return t.get=function(){},t.getSuggested=function(t){return e({method:"GET",url:"/api/notes/suggested?searchText="+t,headers:{Accept:"application/json"}})},t.getByTag=function(t){return e({method:"GET",url:"/api/notes/bytags?searchText="+t,headers:{Accept:"application/json"}})},t.post=function(e){},t.put=function(e){console.table(e)},t}]),app.factory("parts",["$http",function(e){var t={};return t.get=function(t){return e({method:"GET",url:"/api/parts?idOfNote="+t,headers:{Accept:"application/json"}})},t.post=function(t){return e({method:"POST",url:"/api/Parts",data:t,headers:{Accept:"application/json"}})},t.put=function(t){return void 0==t.Settings&&void 0!=t.SettingsAsJSON&&console.warn("Ustawienia part'a zosta≈Çy wyzerowane"),t.SettingsAsJSON=JSON.stringify(t.Settings),console.log(t.SettingsAsJSON),e({method:"PUT",url:"/api/Parts/"+t.ID,data:t,headers:{Accept:"application/json"}})},t}]),app.controller("windowsController",function(e,t,n,o){e.numberOfWindows=[0],e.preventDuplicates=1,e.addWindow=function(t){void 0==t&&e.numberOfWindows.push(0),e.numberOfWindows.splice(t+1,0,e.preventDuplicates),e.preventDuplicates++,console.table(e.numberOfWindows)},e.removeWindow=function(t){e.numberOfWindows.splice(t,1)}});