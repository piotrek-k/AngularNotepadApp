!function(){"use strict"}();var app=angular.module("ConsoleNotepad",["ngRoute"]);app.directive("contenteditable",[function(){return{require:"?ngModel",scope:{},link:function(e,t,n,o){t.bind("blur keyup change",function(){e.$apply(function(){o.$setViewValue(t.html())})}),o.$render=function(){t.html(o.$viewValue)},o.$render(),e.$on("$destroy",function(){t.unbind("blur"),t.unbind("paste"),t.unbind("focus")})}}}]),app.directive("focusOn",function(){return function(e,t,n){e.$on("focusOn",function(e,o){if(o===n.focusOn&&t[0].focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var a=document.createRange();a.selectNodeContents(t[0]),a.collapse(!1);var s=window.getSelection();s.removeAllRanges(),s.addRange(a)}else if("undefined"!=typeof document.body.createTextRange){var r=document.body.createTextRange();r.moveToElementText(t[0]),r.collapse(!1),r.select()}})}}),app.factory("focusOn",function(e,t){return function(n){t(function(){e.$broadcast("focusOn",n)})}}),app.controller("editorController",function(e,t,n,o){function a(){void 0==e.smartBar&&(e.smartBar=""),t.getByTag(e.smartBar).success(function(t){e.currentNoteId=t.NoteId,e.parts=n.get(e.currentNoteId).success(function(e){u(e)})})}function s(t){e.smartBar="";var o=e.suggestions[t];console.table(o);for(var a in o.NoteTags)e.smartBar+=o.NoteTags[a].Tag.Name+" ";e.currentNoteId=o.NoteId,e.parts=n.get(e.currentNoteId).success(function(e){u(e)})}function r(t){e.parts[t].localState="Sending",n.put(e.parts[t]).success(function(){e.parts[t].localState="OK"}).error(function(){e.parts[t].localState="Problem"})}function i(t){var o=t+1;null==t&&(o=0),e.parts.splice(o,0,{Data:"&nbsp;",NoteID:e.currentNoteId}),console.log("------focusOn"),document.getElementById("part"+o+"_window"+e.$index).focus(),e.parts[o].localState="Sending",n.post(e.parts[o]).success(function(t){e.parts[o].ID=t.ID,e.parts[o].localState="OK"}).error(function(){e.parts[o].localState="Problem"})}function c(){(0==e.parts.length||null==e.parts)&&i()}function u(t){e.parts=t,c();var n="part"+(e.parts.length-1)+"window"+e.$index;console.log("---------"+n);var o=document.getElementById(n);console.log(o),null!=o&&o.focus()}e.suggestions={},e.showSuggestions=!1,e.highlightedSuggestion=-1,e.currentNoteId=0,e.parts=[{Data:"new"}];var l;e.focusOnPart=0,a(),o("smartBar"),e.smartBarKeyDown=function(n){32==n.keyCode&&(e.suggestions=t.getSuggested(e.smartBar).success(function(t){console.table(t),e.suggestions=t}),console.log("Suggestions refreshed")),40==n.keyCode&&e.highlightedSuggestion<e.suggestions.length-1?(n.preventDefault(),e.highlightedSuggestion++):38==n.keyCode&&e.highlightedSuggestion>-1?(n.preventDefault(),e.highlightedSuggestion--):13==n.keyCode&&(-1!=e.highlightedSuggestion?s(e.highlightedSuggestion):a()),13!=n.keyCode&&40!=n.keyCode&&38!=n.keyCode&&(e.highlightedSuggestion=-1)},e.editingPartKeyDown=function(t,n){clearTimeout(l),l=setTimeout(function(){r(n)},1e3),e.parts[n].localState="Sending";var o=e.parts[n];13==t.keyCode&&/\s*<br>\s*<br>\s*$/.test(o.Data)&&(e.parts[n].Data=e.parts[n].Data.replace(/\s*<br>\s*$/g,""),i(n),t.preventDefault())},e.suggestionClicked=function(e,t){console.log("CLICKED"),1===t.which&&s(e)}}),app.factory("notes",["$http",function(e){var t={};return t.get=function(){},t.getSuggested=function(t){return e({method:"GET",url:"/api/notes/suggested?searchText="+t,headers:{Accept:"application/json"}})},t.getByTag=function(t){return e({method:"GET",url:"/api/notes/bytags?searchText="+t,headers:{Accept:"application/json"}})},t.post=function(e){},t.put=function(e){console.table(e)},t}]),app.factory("parts",["$http",function(e){var t={};return t.get=function(t){return e({method:"GET",url:"/api/parts?idOfNote="+t,headers:{Accept:"application/json"}})},t.post=function(t){return e({method:"POST",url:"/api/Parts",data:t,headers:{Accept:"application/json"}})},t.put=function(t){return e({method:"PUT",url:"/api/Parts/"+t.ID,data:t,headers:{Accept:"application/json"}})},t}]),app.controller("windowsController",function(e,t,n,o){e.numberOfWindows=[0],e.preventDuplicates=1,e.addWindow=function(t){void 0==t&&e.numberOfWindows.push(0),e.numberOfWindows.splice(t+1,0,e.preventDuplicates),e.preventDuplicates++,console.table(e.numberOfWindows)},e.removeWindow=function(t){e.numberOfWindows.splice(t,1)}});