!function(){"use strict"}();var app=angular.module("ConsoleNotepad",["ngRoute"]);app.directive("contenteditable",[function(){return{require:"?ngModel",scope:{},link:function(t,e,n,o){e.bind("blur keyup change",function(){t.$apply(function(){o.$setViewValue(e.html())})}),o.$render=function(){e.html(o.$viewValue)},o.$render(),t.$on("$destroy",function(){e.unbind("blur"),e.unbind("paste"),e.unbind("focus")})}}}]),app.directive("focusOn",function(t){return function(e,n,o){e.$on("focusOn",function(e,r){r===o.focusOn&&t(function(){if(n[0].focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var t=document.createRange();t.selectNodeContents(n[0]),t.collapse(!1);var e=window.getSelection();e.removeAllRanges(),e.addRange(t)}else if("undefined"!=typeof document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(n[0]),o.collapse(!1),o.select()}})})}}),app.factory("focusOn",function(t,e){return function(n){e(function(){t.$broadcast("focusOn",n)})}}),app.controller("editorController",function(t,e,n,o){function r(){void 0==t.smartBar&&(t.smartBar=""),e.getByTag(t.smartBar).success(function(e){t.currentNoteId=e.NoteId,t.parts=n.get(t.currentNoteId).success(function(t){c(t)})})}function a(e){t.smartBar="";var o=t.suggestions[e];console.table(o);for(var r in o.NoteTags)t.smartBar+=o.NoteTags[r].Tag.Name+" ";t.currentNoteId=o.NoteId,t.parts=n.get(t.currentNoteId).success(function(t){c(t)})}function i(e){t.parts[e].localState="Sending",n.put(t.parts[e]).success(function(){t.parts[e].localState="OK"}).error(function(){t.parts[e].localState="Problem"})}function s(){(0==t.parts.length||null==t.parts)&&t.addPart()}function c(e){t.parts=e,s(),o("part"+(t.parts.length-1)+"window"+t.$index)}t.suggestions={},t.showSuggestions=!1,t.highlightedSuggestion=-1,t.currentNoteId=0,t.parts=[{Data:"new"}];var u;t.focusOnPart=0,t.activePart=0,r(),o("smartBar"),t.smartBarKeyDown=function(n){32==n.keyCode&&(t.suggestions=e.getSuggested(t.smartBar).success(function(e){console.table(e),t.suggestions=e}),console.log("Suggestions refreshed")),40==n.keyCode&&t.highlightedSuggestion<t.suggestions.length-1?(n.preventDefault(),t.highlightedSuggestion++):38==n.keyCode&&t.highlightedSuggestion>-1?(n.preventDefault(),t.highlightedSuggestion--):13==n.keyCode&&(-1!=t.highlightedSuggestion?a(t.highlightedSuggestion):r()),13!=n.keyCode&&40!=n.keyCode&&38!=n.keyCode&&(t.highlightedSuggestion=-1)},t.editingPartKeyDown=function(e,n){clearTimeout(u),u=setTimeout(function(){i(n)},1e3),t.parts[n].localState="Sending"},t.addPart=function(){var e=t.activePart+1;t.parts.splice(e,0,{Data:"&nbsp;",NoteID:t.currentNoteId}),o("part"+e+"window"+t.$index),t.parts[e].localState="Sending",t.parts[e].OrderPosition=t.parts[e-1].OrderPosition+1;for(var r in t.parts)r!=e&&t.parts[r].OrderPosition>=t.parts[e].OrderPosition&&t.parts[r].OrderPosition++;n.post(t.parts[e]).success(function(n){t.parts[e].ID=n.ID,t.parts[e].localState="OK"}).error(function(){t.parts[e].localState="Problem"})},t.suggestionClicked=function(t,e){1===e.which&&a(t)},t.focusedOnPart=function(e){t.activePart=e}}),app.factory("notes",["$http",function(t){var e={};return e.get=function(){},e.getSuggested=function(e){return t({method:"GET",url:"/api/notes/suggested?searchText="+e,headers:{Accept:"application/json"}})},e.getByTag=function(e){return t({method:"GET",url:"/api/notes/bytags?searchText="+e,headers:{Accept:"application/json"}})},e.post=function(t){},e.put=function(t){console.table(t)},e}]),app.factory("parts",["$http",function(t){var e={};return e.get=function(e){return t({method:"GET",url:"/api/parts?idOfNote="+e,headers:{Accept:"application/json"}})},e.post=function(e){return t({method:"POST",url:"/api/Parts",data:e,headers:{Accept:"application/json"}})},e.put=function(e){return t({method:"PUT",url:"/api/Parts/"+e.ID,data:e,headers:{Accept:"application/json"}})},e}]),app.controller("windowsController",function(t,e,n,o){t.numberOfWindows=[0],t.preventDuplicates=1,t.addWindow=function(e){void 0==e&&t.numberOfWindows.push(0),t.numberOfWindows.splice(e+1,0,t.preventDuplicates),t.preventDuplicates++,console.table(t.numberOfWindows)},t.removeWindow=function(e){t.numberOfWindows.splice(e,1)}});