!function(){"use strict"}();var app=angular.module("ConsoleNotepad",["ngRoute"]);app.directive("contenteditable",[function(){return{require:"?ngModel",scope:{},link:function(e,t,n,o){t.bind("blur keyup change",function(){e.$apply(function(){o.$setViewValue(t.html())})}),o.$render=function(){t.html(o.$viewValue)},o.$render(),e.$on("$destroy",function(){t.unbind("blur"),t.unbind("paste"),t.unbind("focus")})}}}]),app.directive("focusOn",function(){return function(e,t,n){e.$on("focusOn",function(e,o){if(o===n.focusOn&&t[0].focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var a=document.createRange();a.selectNodeContents(t[0]),a.collapse(!1);var r=window.getSelection();r.removeAllRanges(),r.addRange(a)}else if("undefined"!=typeof document.body.createTextRange){var s=document.body.createTextRange();s.moveToElementText(t[0]),s.collapse(!1),s.select()}})}}),app.factory("focusOn",function(e,t){return function(n){t(function(){e.$broadcast("focusOn",n)})}}),app.controller("editorController",function(e,t,n,o){function a(){void 0==e.smartBar&&(e.smartBar=""),t.getByTag(e.smartBar).success(function(t){console.table(t),e.currentNoteId=t.NoteId,e.parts=n.get(e.currentNoteId).success(function(e){i(e)})})}function r(t){e.parts[t].localState="Sending",n.put(e.parts[t]).success(function(){e.parts[t].localState="OK"}).error(function(){e.parts[t].localState="Problem"})}function s(t){var a=t+1;null==t&&(a=0),e.parts.splice(a,0,{Data:"&nbsp;",NoteID:e.currentNoteId}),o("part"+a),e.parts[a].localState="Sending",n.post(e.parts[a]).success(function(t){e.parts[a].ID=t.ID,e.parts[a].localState="OK"}).error(function(){e.parts[a].localState="Problem"})}function c(){(0==e.parts.length||null==e.parts)&&s()}function i(t){e.parts=t,console.log("Got data: "),console.table(t),c(),o("part"+(e.parts.length-1))}e.suggestions={},e.showSuggestions=!1,e.highlightedSuggestion=-1,e.currentNoteId=0,e.parts=[{Data:"new"}];var u;e.focusOnPart=0,e.numberOfWindows=2,e.createArrayOfNElements=function(e){return new Array(e)},o("smartBar"),a(),e.smartBarKeyDown=function(o){if(32==o.keyCode&&(e.suggestions=t.getSuggested(e.smartBar).success(function(t){console.table(t),e.suggestions=t}),console.log("Suggestions refreshed")),40==o.keyCode&&e.highlightedSuggestion<e.suggestions.length-1)o.preventDefault(),e.highlightedSuggestion++;else if(38==o.keyCode&&e.highlightedSuggestion>-1)o.preventDefault(),e.highlightedSuggestion--;else if(13==o.keyCode)if(-1!=e.highlightedSuggestion){e.smartBar="";var r=e.suggestions[e.highlightedSuggestion];console.table(r);for(var s in r.NoteTags)e.smartBar+=r.NoteTags[s].Tag.Name+" ";e.currentNoteId=r.NoteId,e.parts=n.get(e.currentNoteId).success(function(e){i(e)})}else a();13!=o.keyCode&&40!=o.keyCode&&38!=o.keyCode&&(e.highlightedSuggestion=-1)},e.editingPartKeyDown=function(t,n){clearTimeout(u),u=setTimeout(function(){r(n)},1e3),e.parts[n].localState="Sending";var o=e.parts[n];13==t.keyCode&&/\s*<br>\s*<br>\s*$/.test(o.Data)&&(e.parts[n].Data=e.parts[n].Data.replace(/\s*<br>\s*$/g,""),s(n),t.preventDefault())}}),app.factory("notes",["$http",function(e){var t={};return t.get=function(){},t.getSuggested=function(t){return e({method:"GET",url:"/api/notes/suggested?searchText="+t,headers:{Accept:"application/json"}})},t.getByTag=function(t){return e({method:"GET",url:"/api/notes/bytags?searchText="+t,headers:{Accept:"application/json"}})},t.post=function(e){},t.put=function(e){console.table(e)},t}]),app.factory("parts",["$http",function(e){var t={};return t.get=function(t){return e({method:"GET",url:"/api/parts?idOfNote="+t,headers:{Accept:"application/json"}})},t.post=function(t){return e({method:"POST",url:"/api/Parts",data:t,headers:{Accept:"application/json"}})},t.put=function(t){return e({method:"PUT",url:"/api/Parts/"+t.ID,data:t,headers:{Accept:"application/json"}})},t}]);