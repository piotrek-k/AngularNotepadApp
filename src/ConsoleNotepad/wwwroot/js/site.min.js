!function(){"use strict"}();var app=angular.module("ConsoleNotepad",["ngRoute"]);app.directive("contenteditable",[function(){return{require:"?ngModel",scope:{},link:function(e,t,n,o){t.bind("blur keyup change",function(){e.$apply(function(){o.$setViewValue(t.html())})}),o.$render=function(){t.html(o.$viewValue)},o.$render(),e.$on("$destroy",function(){t.unbind("blur"),t.unbind("paste"),t.unbind("focus")})}}}]),app.directive("focusOn",function(e){return function(t,n,o){t.$on("focusOn",function(t,a){a===o.focusOn&&e(function(){if(n[0].focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var e=document.createRange();e.selectNodeContents(n[0]),e.collapse(!1);var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}else if("undefined"!=typeof document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(n[0]),o.collapse(!1),o.select()}})})}}),app.factory("focusOn",function(e,t){return function(n){t(function(){e.$broadcast("focusOn",n)})}}),app.controller("editorController",function(e,t,n,o){function a(){void 0==e.smartBar&&(e.smartBar=""),t.getByTag(e.smartBar).success(function(t){e.currentNoteId=t.NoteId,e.parts=n.get(e.currentNoteId).success(function(e){c(e)})})}function r(t){e.smartBar="";var o=e.suggestions[t];console.table(o);for(var a in o.NoteTags)e.smartBar+=o.NoteTags[a].Tag.Name+" ";e.currentNoteId=o.NoteId,e.parts=n.get(e.currentNoteId).success(function(e){c(e)})}function i(t){e.parts[t].localState="Sending",n.put(e.parts[t]).success(function(){e.parts[t].localState="OK"}).error(function(){e.parts[t].localState="Problem"})}function s(){(0==e.parts.length||null==e.parts)&&e.addPart()}function c(t){e.parts=t,s(),o("part"+(e.parts.length-1)+"window"+e.$index)}e.suggestions={},e.showSuggestions=!1,e.highlightedSuggestion=-1,e.currentNoteId=0,e.parts=[{Data:"new"}];var u;e.focusOnPart=0,e.activePart=0,a(),o("smartBar"),e.smartBarKeyDown=function(n){32==n.keyCode&&(e.suggestions=t.getSuggested(e.smartBar).success(function(t){console.table(t),e.suggestions=t}),console.log("Suggestions refreshed")),40==n.keyCode&&e.highlightedSuggestion<e.suggestions.length-1?(n.preventDefault(),e.highlightedSuggestion++):38==n.keyCode&&e.highlightedSuggestion>-1?(n.preventDefault(),e.highlightedSuggestion--):13==n.keyCode&&(-1!=e.highlightedSuggestion?r(e.highlightedSuggestion):a()),13!=n.keyCode&&40!=n.keyCode&&38!=n.keyCode&&(e.highlightedSuggestion=-1)},e.editingPartKeyDown=function(t,n){clearTimeout(u),u=setTimeout(function(){i(n)},1e3),e.parts[n].localState="Sending"},e.addPart=function(){var t=e.activePart+1;e.parts.splice(t,0,{Data:"&nbsp;",NoteID:e.currentNoteId}),o("part"+t+"window"+e.$index),e.parts[t].localState="Sending",n.post(e.parts[t]).success(function(n){e.parts[t].ID=n.ID,e.parts[t].localState="OK"}).error(function(){e.parts[t].localState="Problem"})},e.suggestionClicked=function(e,t){1===t.which&&r(e)},e.focusedOnPart=function(t){e.activePart=t}}),app.factory("notes",["$http",function(e){var t={};return t.get=function(){},t.getSuggested=function(t){return e({method:"GET",url:"/api/notes/suggested?searchText="+t,headers:{Accept:"application/json"}})},t.getByTag=function(t){return e({method:"GET",url:"/api/notes/bytags?searchText="+t,headers:{Accept:"application/json"}})},t.post=function(e){},t.put=function(e){console.table(e)},t}]),app.factory("parts",["$http",function(e){var t={};return t.get=function(t){return e({method:"GET",url:"/api/parts?idOfNote="+t,headers:{Accept:"application/json"}})},t.post=function(t){return e({method:"POST",url:"/api/Parts",data:t,headers:{Accept:"application/json"}})},t.put=function(t){return e({method:"PUT",url:"/api/Parts/"+t.ID,data:t,headers:{Accept:"application/json"}})},t}]),app.controller("windowsController",function(e,t,n,o){e.numberOfWindows=[0],e.preventDuplicates=1,e.addWindow=function(t){void 0==t&&e.numberOfWindows.push(0),e.numberOfWindows.splice(t+1,0,e.preventDuplicates),e.preventDuplicates++,console.table(e.numberOfWindows)},e.removeWindow=function(t){e.numberOfWindows.splice(t,1)}});